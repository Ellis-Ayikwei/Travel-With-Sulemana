{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Travel-With-Sulemana/apps/frontend/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\n// Simple compatibility wrapper - react-auth-kit handles everything\n// This file maintains backward compatibility with existing useAuth() calls\n// while using react-auth-kit under the hood\n\ninterface User {\n  id: string;\n  email: string;\n  first_name: string;\n  last_name: string;\n  user_type: \"customer\" | \"driver\" | \"admin\";\n}\n\n// Dynamic import to handle react-auth-kit's export structure\nlet ReactAuthKit: any;\ntry {\n  ReactAuthKit = require(\"react-auth-kit\");\n} catch (e) {\n  ReactAuthKit = {};\n}\n\n// Custom hook that wraps react-auth-kit to maintain existing API\nexport function useAuth() {\n  // Call hooks unconditionally - React requirement\n  // Wrap in try-catch to handle cases where react-auth-kit isn't loaded\n  let signIn: any = null;\n  let signOut: any = null;\n  let authUser: any = null;\n  let isAuthenticated: any = null;\n  \n  try {\n    if (ReactAuthKit.useSignIn) {\n      signIn = ReactAuthKit.useSignIn();\n    }\n    if (ReactAuthKit.useSignOut) {\n      signOut = ReactAuthKit.useSignOut();\n    }\n    if (ReactAuthKit.useAuthUser) {\n      authUser = ReactAuthKit.useAuthUser();\n    }\n    if (ReactAuthKit.useIsAuthenticated) {\n      isAuthenticated = ReactAuthKit.useIsAuthenticated();\n    }\n  } catch (error) {\n    console.error(\"Error initializing react-auth-kit hooks\", error);\n  }\n  \n  // Make state reactive with useState\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [isAuth, setIsAuth] = useState(false);\n  \n  // Get user data - authUser is a function that returns the user\n  const getUser = (): User | null => {\n    try {\n      if (authUser && typeof authUser === 'function') {\n        const user = authUser() as User | null;\n        return user;\n      }\n      // Fallback: check localStorage token and decode\n      if (typeof window !== \"undefined\") {\n        const token = localStorage.getItem(\"campusride_access_token\");\n        if (token) {\n          try {\n            const base64Url = token.split('.')[1];\n            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n            const jsonPayload = decodeURIComponent(\n              atob(base64)\n                .split('')\n                .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n                .join('')\n            );\n            const decoded = JSON.parse(jsonPayload) as { id: string; email: string; user_type: string };\n            return {\n              id: decoded.id,\n              email: decoded.email,\n              first_name: \"\",\n              last_name: \"\",\n              user_type: decoded.user_type as \"customer\" | \"driver\" | \"admin\",\n            };\n          } catch (e) {\n            // Token decode failed\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Error getting user\", error);\n    }\n    return null;\n  };\n  \n  // Check if authenticated\n  const getIsAuthenticated = (): boolean => {\n    try {\n      if (isAuthenticated && typeof isAuthenticated === 'function') {\n        return isAuthenticated();\n      }\n      // Fallback: check if token exists\n      if (typeof window !== \"undefined\") {\n        const token = localStorage.getItem(\"campusride_access_token\");\n        return !!token;\n      }\n    } catch (error) {\n      console.error(\"Error checking authentication\", error);\n    }\n    return false;\n  };\n\n  // Sync state with react-auth-kit on mount and when it changes\n  useEffect(() => {\n    const updateAuthState = () => {\n      const user = getUser();\n      const authenticated = getIsAuthenticated();\n      setCurrentUser(user);\n      setIsAuth(authenticated);\n    };\n    \n    // Initial load\n    updateAuthState();\n    \n    // Poll for changes every 2 seconds (react-auth-kit should trigger re-renders, but this ensures sync)\n    const interval = setInterval(updateAuthState, 2000);\n    \n    // Also listen for storage changes (when logout clears localStorage)\n    const handleStorageChange = () => {\n      updateAuthState();\n    };\n    window.addEventListener('storage', handleStorageChange);\n    \n    return () => {\n      clearInterval(interval);\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, [authUser, isAuthenticated]);\n\n  return {\n    user: currentUser,\n    isAuthenticated: isAuth,\n    isLoading: false, // react-auth-kit handles this internally\n    login: (access: string, refresh?: string, userData?: User) => {\n      // Store tokens in localStorage (for backward compatibility with api.ts)\n      if (typeof window !== \"undefined\") {\n        localStorage.setItem(\"campusride_access_token\", access);\n        if (refresh) localStorage.setItem(\"campusride_refresh_token\", refresh);\n      }\n\n      // Try to get user data from parameter, token, or fetch from API\n      let authState: User | null = userData || null;\n      \n      if (!authState) {\n        // Decode token to get user info as fallback\n        try {\n          const base64Url = access.split('.')[1];\n          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n          const jsonPayload = decodeURIComponent(\n            atob(base64)\n              .split('')\n              .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n              .join('')\n          );\n          const decoded = JSON.parse(jsonPayload) as { id: string; email: string; user_type: string };\n          \n          authState = {\n            id: decoded.id,\n            email: decoded.email,\n            first_name: \"\",\n            last_name: \"\",\n            user_type: decoded.user_type as \"customer\" | \"driver\" | \"admin\",\n          };\n        } catch (error) {\n          console.error(\"Failed to decode token\", error);\n          return;\n        }\n      }\n\n      // Use react-auth-kit's signIn\n      if (signIn && typeof signIn === 'function') {\n        try {\n          const success = signIn({\n            token: access,\n            expiresIn: 604800, // 7 days\n            tokenType: \"Bearer\",\n            authState: authState,\n          });\n          // Immediately update state if signIn succeeded\n          if (success) {\n            setCurrentUser(authState);\n            setIsAuth(true);\n          }\n        } catch (error) {\n          console.error(\"Failed to sign in with react-auth-kit\", error);\n        }\n      } else {\n        // Fallback: update state directly if react-auth-kit isn't available\n        setCurrentUser(authState);\n        setIsAuth(true);\n      }\n    },\n    logout: () => {\n      // Clear tokens from localStorage\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem(\"campusride_access_token\");\n        localStorage.removeItem(\"campusride_refresh_token\");\n      }\n      if (signOut && typeof signOut === 'function') {\n        try {\n          signOut();\n        } catch (error) {\n          console.error(\"Failed to sign out with react-auth-kit\", error);\n        }\n      }\n      // Immediately update state\n      setCurrentUser(null);\n      setIsAuth(false);\n    },\n    refreshUser: async () => {\n      // For now, just return - react-auth-kit handles state automatically\n      return Promise.resolve();\n    },\n  };\n}\n\n// Export react-auth-kit's AuthProvider for use in Providers\nexport const AuthProvider = ReactAuthKit.AuthProvider || ((props: any) => props.children);\n"],"names":[],"mappings":";;;;;;AAEA;AAFA;;AAgBA,6DAA6D;AAC7D,IAAI;AACJ,IAAI;IACF;AACF,EAAE,OAAO,GAAG;IACV,eAAe,CAAC;AAClB;AAGO,SAAS;IACd,iDAAiD;IACjD,sEAAsE;IACtE,IAAI,SAAc;IAClB,IAAI,UAAe;IACnB,IAAI,WAAgB;IACpB,IAAI,kBAAuB;IAE3B,IAAI;QACF,IAAI,aAAa,SAAS,EAAE;YAC1B,SAAS,aAAa,SAAS;QACjC;QACA,IAAI,aAAa,UAAU,EAAE;YAC3B,UAAU,aAAa,UAAU;QACnC;QACA,IAAI,aAAa,WAAW,EAAE;YAC5B,WAAW,aAAa,WAAW;QACrC;QACA,IAAI,aAAa,kBAAkB,EAAE;YACnC,kBAAkB,aAAa,kBAAkB;QACnD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;IAC3D;IAEA,oCAAoC;IACpC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAc;IAC5D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IAErC,+DAA+D;IAC/D,MAAM,UAAU;QACd,IAAI;YACF,IAAI,YAAY,OAAO,aAAa,YAAY;gBAC9C,MAAM,OAAO;gBACb,OAAO;YACT;YACA,gDAAgD;YAChD;;QAyBF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;QACtC;QACA,OAAO;IACT;IAEA,yBAAyB;IACzB,MAAM,qBAAqB;QACzB,IAAI;YACF,IAAI,mBAAmB,OAAO,oBAAoB,YAAY;gBAC5D,OAAO;YACT;YACA,kCAAkC;YAClC;;QAIF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;QACjD;QACA,OAAO;IACT;IAEA,8DAA8D;IAC9D,IAAA,kNAAS,EAAC;QACR,MAAM,kBAAkB;YACtB,MAAM,OAAO;YACb,MAAM,gBAAgB;YACtB,eAAe;YACf,UAAU;QACZ;QAEA,eAAe;QACf;QAEA,qGAAqG;QACrG,MAAM,WAAW,YAAY,iBAAiB;QAE9C,oEAAoE;QACpE,MAAM,sBAAsB;YAC1B;QACF;QACA,OAAO,gBAAgB,CAAC,WAAW;QAEnC,OAAO;YACL,cAAc;YACd,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG;QAAC;QAAU;KAAgB;IAE9B,OAAO;QACL,MAAM;QACN,iBAAiB;QACjB,WAAW;QACX,OAAO,CAAC,QAAgB,SAAkB;YACxC,wEAAwE;YACxE;;YAKA,gEAAgE;YAChE,IAAI,YAAyB,YAAY;YAEzC,IAAI,CAAC,WAAW;gBACd,4CAA4C;gBAC5C,IAAI;oBACF,MAAM,YAAY,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE;oBACtC,MAAM,SAAS,UAAU,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;oBAC1D,MAAM,cAAc,mBAClB,KAAK,QACF,KAAK,CAAC,IACN,GAAG,CAAC,CAAC,IAAM,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,IAC9D,IAAI,CAAC;oBAEV,MAAM,UAAU,KAAK,KAAK,CAAC;oBAE3B,YAAY;wBACV,IAAI,QAAQ,EAAE;wBACd,OAAO,QAAQ,KAAK;wBACpB,YAAY;wBACZ,WAAW;wBACX,WAAW,QAAQ,SAAS;oBAC9B;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,0BAA0B;oBACxC;gBACF;YACF;YAEA,8BAA8B;YAC9B,IAAI,UAAU,OAAO,WAAW,YAAY;gBAC1C,IAAI;oBACF,MAAM,UAAU,OAAO;wBACrB,OAAO;wBACP,WAAW;wBACX,WAAW;wBACX,WAAW;oBACb;oBACA,+CAA+C;oBAC/C,IAAI,SAAS;wBACX,eAAe;wBACf,UAAU;oBACZ;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,yCAAyC;gBACzD;YACF,OAAO;gBACL,oEAAoE;gBACpE,eAAe;gBACf,UAAU;YACZ;QACF;QACA,QAAQ;YACN,iCAAiC;YACjC;;YAIA,IAAI,WAAW,OAAO,YAAY,YAAY;gBAC5C,IAAI;oBACF;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,0CAA0C;gBAC1D;YACF;YACA,2BAA2B;YAC3B,eAAe;YACf,UAAU;QACZ;QACA,aAAa;YACX,oEAAoE;YACpE,OAAO,QAAQ,OAAO;QACxB;IACF;AACF;AAGO,MAAM,eAAe,aAAa,YAAY,IAAI,CAAC,CAAC,QAAe,MAAM,QAAQ","debugId":null}},
    {"offset": {"line": 184, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Travel-With-Sulemana/apps/frontend/components/providers.tsx"],"sourcesContent":["\"use client\";\n\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { ThemeProvider } from \"next-themes\";\nimport { useState } from \"react\";\nimport { AuthProvider } from \"@/contexts/AuthContext\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(\n    () =>\n      new QueryClient({\n        defaultOptions: {\n          queries: {\n            staleTime: 60 * 1000,\n            refetchOnWindowFocus: false,\n          },\n        },\n      })\n  );\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider attribute=\"class\" defaultTheme=\"dark\" enableSystem={false}>\n        <AuthProvider\n          authType={\"localstorage\"}\n          authName={\"_auth\"}\n          cookieDomain={typeof window !== \"undefined\" ? window.location.hostname : undefined}\n          cookieSecure={false}\n        >\n          {children}\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AACA;AALA;;;;;;AAOO,SAAS,UAAU,EAAE,QAAQ,EAAiC;IACnE,MAAM,CAAC,YAAY,GAAG,IAAA,iNAAQ,EAC5B,IACE,IAAI,4LAAW,CAAC;YACd,gBAAgB;gBACd,SAAS;oBACP,WAAW,KAAK;oBAChB,sBAAsB;gBACxB;YACF;QACF;IAGJ,qBACE,8OAAC,6MAAmB;QAAC,QAAQ;kBAC3B,cAAA,8OAAC,iKAAa;YAAC,WAAU;YAAQ,cAAa;YAAO,cAAc;sBACjE,cAAA,8OAAC,4JAAY;gBACX,UAAU;gBACV,UAAU;gBACV,cAAc,sCAAgC,0BAA2B;gBACzE,cAAc;0BAEb;;;;;;;;;;;;;;;;AAKX","debugId":null}}]
}